!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).stayjs={})}(this,function(e){"use strict";function d(t,n){return function(e){n?e.setAttribute(t,n):e.removeAttribute(t)}}var m={state:1,memo:1,ref:1};function b(e,t){if(t&&t.tagName&&"style"!==t.tagName)if("number"==typeof e||"string"==typeof e){var n=e;(e=document.createElement("span")).textContent=n}else void 0===e&&(e=document.createElement("span"));return e}var g=function(e,f,t){f&&f.by&&(e=f.by,delete f.by);var i,o,s=e;if("string"==typeof e)s=document.createElement(e);else if("function"==typeof e)return f&&t&&(f.children=t),e(f);var n,r=f&&f.state;r&&(n=function(){n=o=i=null});function a(){i&&Object.keys(i).forEach(function(e){i[e]()}),o&&Object.keys(o).forEach(function(e){var t=o[e],n=t[0],r=t[1];if(r.parentElement){var f=b(n(),r.parentElement);r.parentElement.replaceChild(f,r),o[e]=[n,f]}})}var c=[],u=Array.isArray(f);f&&u&&(t=f);var l=function(e){if(e&&e.length)for(var t=0;t<e.length;t++){if(Array.isArray(e[t]))return void l(e[t]);if(e[t])if(e[t].__token)c.push(g(e[t].tag,e[t].props,e[t].children));else if("function"==typeof e[t]){var n=b(e[t](),s);f&&f.state&&((o=o||{})[t]=[e[t],n]),c.push(n)}else c.push(e[t])}};if(l(t),f)if("string"==typeof f)s.className=f;else if("function"==typeof f)f(s);else if(!u){if(Object.keys(f).forEach(function(e){if(!m[e]){var n=f[e];if("function"==typeof n)if(i=i||{},0===e.indexOf("on"))s[e]=n;else if(0===e.indexOf("listen")){var t=e.replace("listen","on"),r=s[t];s[t]=function(e){r&&r(e),n(e)}}else"cssText"===e?i[e]=function(){s.style.cssText=n()}:"class"===e?i[e]=function(){s.className=n()}:"style"===e?i[e]=function(){var t=n();Object.keys(t).forEach(function(e){s.style[e]=t[e]})}:0<e.indexOf("-")?i[e]=function(){d(e,n())}:i[e]=function(){s[e]=n()};else if("class"===e)s.className=n;else if("cssText"===e)s.style.cssText=n;else if("style"===e){Object.keys(n).forEach(function(e){s.style[e]=n[e]})}else 0<e.indexOf("-")||(s[e]=n)}}),r){var p;Array.isArray(r)||(r=[r]);var h=f.memo;"function"==typeof h&&(p=h()),r.forEach(function(e){e.__subscribeElement(function(){if(h){for(var e=h(),t=0;t<e.length;t++)if(e[t]!==p[t]){a();break}p=e}else a()},n)(s)})}var y=f.ref;"function"==typeof y?y(s):y&&y.forEach(function(e){e(s)})}if(c.length){var v=[];c.forEach(function(e){Array.isArray(e)?e.forEach(function(e){v.push(e)}):v.push(e)}),s.append.apply(s,v)}return a(),s},n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var f in t=arguments[n])Object.prototype.hasOwnProperty.call(t,f)&&(e[f]=t[f]);return e}).apply(this,arguments)};function t(e){var i=new Set,t=n({},e,{__next:function(){requestAnimationFrame(function(){i.forEach(function(e){return e(t)})})},update:function(e){e(t),t.__next()},__subscribe:function(e){i.add(e)},__subscribeElement:function(r,f){return function(n){r(t),t.__subscribe(function e(t){document.contains(n)||(n=null,i.delete(e),f&&f()),r(t)})}}});return t}var a=function(e,t,n,r){var f;t[0]=0;for(var i=1;i<t.length;i++){var o=t[i++],s=t[i]?(t[0]|=o?1:2,n[t[i++]]):t[++i];3===o?r[0]=s:4===o?r[1]=Object.assign(r[1]||{},s):5===o?(r[1]=r[1]||{})[t[++i]]=s:6===o?r[1][t[++i]]+=s+"":o?(f=e.apply(s,a(e,s,n,["",null])),r.push(f),s[0]?t[0]|=2:(t[i-2]=0,t[i]=f)):r.push(s)}return r},r=new Map;function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=i.apply(void 0,[e].concat(t));return g(r.tag,r.props,r.children)}var i=function(e){var t=r.get(this);return t||(t=new Map,r.set(this,t)),1<(t=a(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,r=1,f="",i="",o=[0],s=function(e){1===r&&(e||(f=f.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(0,e,f):3===r&&(e||f)?(o.push(3,e,f),r=2):2===r&&"..."===f&&e?o.push(4,e,0):2===r&&f&&!e?o.push(5,0,!0,f):5<=r&&((f||!e&&5===r)&&(o.push(r,0,f,n),r=6),e&&(o.push(r,e,0,n),r=6)),f=""},a=0;a<e.length;a++){a&&(1===r&&s(),s(a));for(var c=0;c<e[a].length;c++)t=e[a][c],1===r?"<"===t?(s(),o=[o],r=3):f+=t:4===r?f="--"===f&&">"===t?(r=1,""):t+f[0]:i?t===i?i="":f+=t:'"'===t||"'"===t?i=t:">"===t?(s(),r=1):r&&("="===t?(r=5,n=f,f=""):"/"===t&&(r<5||">"===e[a][c+1])?(s(),3===r&&(o=o[0]),(o=(r=o)[0]).push(2,0,r),r=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(s(),r=2):f+=t),3===r&&"!--"===f&&(r=4,o=o[0])}return s(),o}(e)),t),arguments,[])).length?t:t[0]}.bind(function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return{__token:!0,tag:e,props:t||{},children:n,key:t&&t.key||null}}),o={El:g,State:t,fixAttr:d,html:f};e.El=g,e.State=t,e.default=o,e.fixAttr=d,e.html=f,Object.defineProperty(e,"__esModule",{value:!0})});
